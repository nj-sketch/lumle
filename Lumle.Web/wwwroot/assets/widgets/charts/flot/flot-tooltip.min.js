(function(n){var r={tooltip:!1,tooltipOpts:{id:"flotTip",content:"%s | X: %x | Y: %y",xDateFormat:null,yDateFormat:null,monthNames:null,dayNames:null,shifts:{x:10,y:20},defaultTheme:!0,lines:!1,onHover:function(){},$compat:!1}},t=function(n){this.tipPosition={x:0,y:0};this.init(n)},i;t.prototype.init=function(t){function f(n){var i={};i.x=n.pageX;i.y=n.pageY;t.setTooltipPosition(i)}function e(r,u,f){var o=function(n,t,i,r){return Math.sqrt((i-n)*(i-n)+(r-t)*(r-t))},h=function(n,t,i,r,u,f,e){var s,h;if(!e||(e=function(n,t,i,r,u,f){if(typeof i!="undefined")return{x:i,y:t};if(typeof r!="undefined")return{x:n,y:r};var o,e=-1/((f-r)/(u-i));return{x:o=(u*(n*e-t+r)+i*(n*-e+t-f))/(e*(u-i)+r-f),y:e*o-e*n+t}}(n,t,i,r,u,f),e.x>=Math.min(i,u)&&e.x<=Math.max(i,u)&&e.y>=Math.min(r,f)&&e.y<=Math.max(r,f))){var c=r-f,l=u-i,a=i*f-r*u;return Math.abs(c*n+l*t+a)/Math.sqrt(c*c+l*l)}return s=o(n,t,i,r),h=o(n,t,u,f),s>h?h:s},s,e;f?t.showTooltip(f,u):i.plotOptions.series.lines.show&&i.tooltipOptions.lines===!0?(s=i.plotOptions.grid.mouseActiveRadius,e={distance:s+1},n.each(t.getData(),function(n,i){for(var l=0,c=-1,f=1;f<i.data.length;f++)i.data[f-1][0]<=u.x&&i.data[f][0]>=u.x&&(l=f-1,c=f);if(c===-1){t.hideTooltip();return}var r={x:i.data[l][0],y:i.data[l][1]},s={x:i.data[c][0],y:i.data[c][1]},a=h(i.xaxis.p2c(u.x),i.yaxis.p2c(u.y),i.xaxis.p2c(r.x),i.yaxis.p2c(r.y),i.xaxis.p2c(s.x),i.yaxis.p2c(s.y),!1);if(a<e.distance){var v=o(r.x,r.y,u.x,u.y)<o(u.x,u.y,s.x,s.y)?l:c,w=i.datapoints.pointsize,y=[u.x,r.y+(s.y-r.y)*((u.x-r.x)/(s.x-r.x))],p={datapoint:y,dataIndex:v,series:i,seriesIndex:n};e={distance:a,item:p}}}),e.distance<s+1?t.showTooltip(e.item,u):t.hideTooltip()):t.hideTooltip()}var i=this,u=n.plot.plugins.length,r;if(this.plotPlugins=[],u)for(r=0;r<u;r++)this.plotPlugins.push(n.plot.plugins[r].name);t.hooks.bindEvents.push(function(t,r){if(i.plotOptions=t.getOptions(),i.plotOptions.tooltip!==!1&&typeof i.plotOptions.tooltip!="undefined"){i.tooltipOptions=i.plotOptions.tooltipOpts;i.tooltipOptions.$compat?(i.wfunc="width",i.hfunc="height"):(i.wfunc="innerWidth",i.hfunc="innerHeight");var u=i.getDomElement();n(t.getPlaceholder()).bind("plothover",e);n(r).bind("mousemove",f)}});t.hooks.shutdown.push(function(t,i){n(t.getPlaceholder()).unbind("plothover",e);n(i).unbind("mousemove",f)});t.setTooltipPosition=function(t){var r=i.getDomElement(),u=r.outerWidth()+i.tooltipOptions.shifts.x,f=r.outerHeight()+i.tooltipOptions.shifts.y;t.x-n(window).scrollLeft()>n(window)[i.wfunc]()-u&&(t.x-=u);t.y-n(window).scrollTop()>n(window)[i.hfunc]()-f&&(t.y-=f);i.tipPosition.x=t.x;i.tipPosition.y=t.y};t.showTooltip=function(n,r){var u=i.getDomElement(),f=i.stringFormat(i.tooltipOptions.content,n);if(u.html(f),t.setTooltipPosition({x:r.pageX,y:r.pageY}),u.css({left:i.tipPosition.x+i.tooltipOptions.shifts.x,top:i.tipPosition.y+i.tooltipOptions.shifts.y}).show(),typeof i.tooltipOptions.onHover=="function")i.tooltipOptions.onHover(n,u)};t.hideTooltip=function(){i.getDomElement().hide().html("")}};t.prototype.getDomElement=function(){var t=n("#"+this.tooltipOptions.id);return t.length===0&&(t=n("<div />").attr("id",this.tooltipOptions.id),t.appendTo("body").hide().css({position:"absolute"}),this.tooltipOptions.defaultTheme&&t.css({background:"#fff","z-index":"1040",padding:"0.4em 0.6em","border-radius":"0.5em","font-size":"0.8em",border:"1px solid #111",display:"none","white-space":"nowrap"})),t};t.prototype.stringFormat=function(n,t){var l=/%s/,a=/%lx/,v=/%ly/,h=/%x\.{0,1}(\d{0,})/,c=/%y\.{0,1}(\d{0,})/,i,r,u,s,f,e,y,o,p;if(typeof t.series.threshold!="undefined"?(i=t.datapoint[0],r=t.datapoint[1],u=t.datapoint[2]):typeof t.series.lines!="undefined"&&t.series.lines.steps?(i=t.series.datapoints.points[t.dataIndex*2],r=t.series.datapoints.points[t.dataIndex*2+1],u=""):(i=t.series.data[t.dataIndex][0],r=t.series.data[t.dataIndex][1],u=t.series.data[t.dataIndex][2]),t.series.label===null&&t.series.originSeries&&(t.series.label=t.series.originSeries.label),typeof n=="function"&&(n=n(t.series.label,i,r,t)),typeof t.series.percent!="undefined"?s=t.series.percent:typeof t.series.percents!="undefined"&&(s=t.series.percents[t.dataIndex]),typeof s=="number"&&(n=this.adjustValPrecision(/%p\.{0,1}(\d{0,})/,n,s)),n=typeof t.series.label!="undefined"?n.replace(l,t.series.label):n.replace(l,""),n=this.hasAxisLabel("xaxis",t)?n.replace(a,t.series.xaxis.options.axisLabel):n.replace(a,""),n=this.hasAxisLabel("yaxis",t)?n.replace(v,t.series.yaxis.options.axisLabel):n.replace(v,""),this.isTimeMode("xaxis",t)&&this.isXDateFormat(t)&&(n=n.replace(h,this.timestampToDate(i,this.tooltipOptions.xDateFormat,t.series.xaxis.options))),this.isTimeMode("yaxis",t)&&this.isYDateFormat(t)&&(n=n.replace(c,this.timestampToDate(r,this.tooltipOptions.yDateFormat,t.series.yaxis.options))),typeof i=="number"&&(n=this.adjustValPrecision(h,n,i)),typeof r=="number"&&(n=this.adjustValPrecision(c,n,r)),typeof t.series.xaxis.ticks!="undefined"&&(f=this.hasRotatedXAxisTicks(t)?"rotatedTicks":"ticks",e=t.dataIndex+t.seriesIndex,t.series.xaxis[f].length>e&&!this.isTimeMode("xaxis",t)&&(y=this.isCategoriesMode("xaxis",t)?t.series.xaxis[f][e].label:t.series.xaxis[f][e].v,y===i&&(n=n.replace(h,t.series.xaxis[f][e].label)))),typeof t.series.yaxis.ticks!="undefined")for(o in t.series.yaxis.ticks)t.series.yaxis.ticks.hasOwnProperty(o)&&(p=this.isCategoriesMode("yaxis",t)?t.series.yaxis.ticks[o].label:t.series.yaxis.ticks[o].v,p===r&&(n=n.replace(c,t.series.yaxis.ticks[o].label)));return typeof t.series.xaxis.tickFormatter!="undefined"&&(n=n.replace("%x",t.series.xaxis.tickFormatter(i,t.series.xaxis).replace(/\$/g,"$$"))),typeof t.series.yaxis.tickFormatter!="undefined"&&(n=n.replace("%y",t.series.yaxis.tickFormatter(r,t.series.yaxis).replace(/\$/g,"$$"))),u&&(n=n.replace("%ct",u)),n};t.prototype.isTimeMode=function(n,t){return typeof t.series[n].options.mode!="undefined"&&t.series[n].options.mode==="time"};t.prototype.isXDateFormat=function(){return typeof this.tooltipOptions.xDateFormat!="undefined"&&this.tooltipOptions.xDateFormat!==null};t.prototype.isYDateFormat=function(){return typeof this.tooltipOptions.yDateFormat!="undefined"&&this.tooltipOptions.yDateFormat!==null};t.prototype.isCategoriesMode=function(n,t){return typeof t.series[n].options.mode!="undefined"&&t.series[n].options.mode==="categories"};t.prototype.timestampToDate=function(t,i,r){var u=n.plot.dateGenerator(t,r);return n.plot.formatDate(u,i,this.tooltipOptions.monthNames,this.tooltipOptions.dayNames)};t.prototype.adjustValPrecision=function(n,t,i){var r,u=t.match(n);return u!==null&&RegExp.$1!==""&&(r=RegExp.$1,i=i.toFixed(r),t=t.replace(n,i)),t};t.prototype.hasAxisLabel=function(t,i){return n.inArray(this.plotPlugins,"axisLabels")!==-1&&typeof i.series[t].options.axisLabel!="undefined"&&i.series[t].options.axisLabel.length>0};t.prototype.hasRotatedXAxisTicks=function(t){return n.inArray(this.plotPlugins,"tickRotor")!==-1&&typeof t.series.xaxis.rotatedTicks!="undefined"};i=function(n){new t(n)};n.plot.plugins.push({init:i,options:r,name:"tooltip",version:"0.8.4"})})(jQuery);