(function(){"use strict";var i=this,t=i.Chart,n=t.helpers;t.Type.extend({name:"Line",defaults:{scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,bezierCurve:!0,bezierCurveTension:.4,pointDot:!0,pointDotRadius:4,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].strokeColor%>"><\/span><%if(datasets[i].label){%><%=datasets[i].label%><%}%><\/li><%}%><\/ul>'},initialize:function(i){this.PointClass=t.Point.extend({strokeWidth:this.options.pointDotStrokeWidth,radius:this.options.pointDotRadius,display:this.options.pointDot,hitDetectionRadius:this.options.pointHitDetectionRadius,ctx:this.chart.ctx,inRange:function(n){return Math.pow(n-this.x,2)<Math.pow(this.radius+this.hitDetectionRadius,2)}});this.datasets=[];this.options.showTooltips&&n.bindEvents(this,this.options.tooltipEvents,function(t){var i=t.type!=="mouseout"?this.getPointsAtEvent(t):[];this.eachPoints(function(n){n.restore(["fillColor","strokeColor"])});n.each(i,function(n){n.fillColor=n.highlightFill;n.strokeColor=n.highlightStroke});this.showTooltip(i)});n.each(i.datasets,function(t){var r={label:t.label||null,fillColor:t.fillColor,strokeColor:t.strokeColor,pointColor:t.pointColor,pointStrokeColor:t.pointStrokeColor,points:[]};this.datasets.push(r);n.each(t.data,function(n,u){r.points.push(new this.PointClass({value:n,label:i.labels[u],datasetLabel:t.label,strokeColor:t.pointStrokeColor,fillColor:t.pointColor,highlightFill:t.pointHighlightFill||t.pointColor,highlightStroke:t.pointHighlightStroke||t.pointStrokeColor}))},this);this.buildScale(i.labels);this.eachPoints(function(t,i){n.extend(t,{x:this.scale.calculateX(i),y:this.scale.endPoint});t.save()},this)},this);this.render()},update:function(){this.scale.update();n.each(this.activeElements,function(n){n.restore(["fillColor","strokeColor"])});this.eachPoints(function(n){n.save()});this.render()},eachPoints:function(t){n.each(this.datasets,function(i){n.each(i.points,t,this)},this)},getPointsAtEvent:function(t){var i=[],r=n.getRelativePosition(t);return n.each(this.datasets,function(t){n.each(t.points,function(n){n.inRange(r.x,r.y)&&i.push(n)})},this),i},buildScale:function(i){var u=this,f=function(){var n=[];return u.eachPoints(function(t){n.push(t.value)}),n},r={templateString:this.options.scaleLabel,height:this.chart.height,width:this.chart.width,ctx:this.chart.ctx,textColor:this.options.scaleFontColor,fontSize:this.options.scaleFontSize,fontStyle:this.options.scaleFontStyle,fontFamily:this.options.scaleFontFamily,valuesCount:i.length,beginAtZero:this.options.scaleBeginAtZero,integersOnly:this.options.scaleIntegersOnly,calculateYRange:function(t){var i=n.calculateScaleRange(f(),t,this.fontSize,this.beginAtZero,this.integersOnly);n.extend(this,i)},xLabels:i,font:n.fontString(this.options.scaleFontSize,this.options.scaleFontStyle,this.options.scaleFontFamily),lineWidth:this.options.scaleLineWidth,lineColor:this.options.scaleLineColor,gridLineWidth:this.options.scaleShowGridLines?this.options.scaleGridLineWidth:0,gridLineColor:this.options.scaleShowGridLines?this.options.scaleGridLineColor:"rgba(0,0,0,0)",padding:this.options.showScale?0:this.options.pointDotRadius+this.options.pointDotStrokeWidth,showLabels:this.options.scaleShowLabels,display:this.options.showScale};this.options.scaleOverride&&n.extend(r,{calculateYRange:n.noop,steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth});this.scale=new t.Scale(r)},addData:function(t,i){n.each(t,function(n,t){this.datasets[t].points.push(new this.PointClass({value:n,label:i,x:this.scale.calculateX(this.scale.valuesCount+1),y:this.scale.endPoint,strokeColor:this.datasets[t].pointStrokeColor,fillColor:this.datasets[t].pointColor}))},this);this.scale.addXLabel(i);this.update()},removeData:function(){this.scale.removeXLabel();n.each(this.datasets,function(n){n.points.shift()},this);this.update()},reflow:function(){var t=n.extend({height:this.chart.height,width:this.chart.width});this.scale.update(t)},draw:function(t){var u=t||1;this.clear();var i=this.chart.ctx,r=function(n){return n.value!==null},e=function(t,i,u){return n.findNextWhere(i,r,u)||t},f=function(t,i,u){return n.findPreviousWhere(i,r,u)||t};this.scale.draw(u);n.each(this.datasets,function(t){var o=n.where(t.points,r);n.each(t.points,function(n,t){n.hasValue()&&n.transition({y:this.scale.calculateY(n.value),x:this.scale.calculateX(t)},u)},this);this.options.bezierCurve&&n.each(o,function(t,i){var r=i>0&&i<o.length-1?this.options.bezierCurveTension:0;t.controlPoints=n.splineCurve(f(t,o,i),t,e(t,o,i),r);t.controlPoints.outer.y>this.scale.endPoint?t.controlPoints.outer.y=this.scale.endPoint:t.controlPoints.outer.y<this.scale.startPoint&&(t.controlPoints.outer.y=this.scale.startPoint);t.controlPoints.inner.y>this.scale.endPoint?t.controlPoints.inner.y=this.scale.endPoint:t.controlPoints.inner.y<this.scale.startPoint&&(t.controlPoints.inner.y=this.scale.startPoint)},this);i.lineWidth=this.options.datasetStrokeWidth;i.strokeStyle=t.strokeColor;i.beginPath();n.each(o,function(n,t){if(t===0)i.moveTo(n.x,n.y);else if(this.options.bezierCurve){var r=f(n,o,t);i.bezierCurveTo(r.controlPoints.outer.x,r.controlPoints.outer.y,n.controlPoints.inner.x,n.controlPoints.inner.y,n.x,n.y)}else i.lineTo(n.x,n.y)},this);i.stroke();this.options.datasetFill&&o.length>0&&(i.lineTo(o[o.length-1].x,this.scale.endPoint),i.lineTo(o[0].x,this.scale.endPoint),i.fillStyle=t.fillColor,i.closePath(),i.fill());n.each(o,function(n){n.draw()})},this)}})}).call(this);