function AuditReport(){table=$("#auditDataTable").DataTable({language:{url:languageFileUrl},serverSide:!0,ajax:{type:"POST",url:rootDir+"audit/auditlog/DataHandler",contentType:"application/json; charset=utf-8",headers:{RequestVerificationToken:token},data:function(n){return n.ModuleName=module,n.ActionName=action,n.StartDate=startDate,n.EndDate=endDate,n.UserName=username,n.FieldName=field,JSON.stringify(n)},error:function(n){var t=JSON.parse(n.getResponseHeader("X-Responded-JSON"));t.status===401?window.location.href="/login?ReturnUrl=%2Fauthorization/User":alert(n.error)}},processing:!0,paging:!0,deferRender:!0,columnDefs:[{searchable:!1,orderable:!1,targets:0,width:"3%"},{searchable:!0,orderable:!0,targets:1,width:"10%"},{searchable:!0,orderable:!0,targets:2,width:"10%"},{searchable:!0,orderable:!1,targets:3,width:"10%"},{searchable:!0,orderable:!0,targets:4,width:"10%"},{searchable:!1,orderable:!1,targets:5},{searchable:!1,orderable:!1,targets:6,width:"5%",border:!0}],columns:[{data:"sn"},{data:"tableName"},{data:"userId"},{data:"auditType"},{data:"convertedCreatedDate"},{data:"auditSummary"},{render:toolButton,searchable:!1,orderable:!1}],order:[1,"asc"]})}function GetAuditHistory(n,t,i){$("#audit").html("");var r="",u=rootDir+"audit/auditlog/report?id="+n+"&tn="+t;$.getJSON(u,function(n){for(var u,t=0;t<n.length;t++){if(r=r+"<div class='col-md-12 panel-heading custom-audit-heading' data-toggle='collapse' data-parent='#accordion' href='#collapseOne"+t+"'aria-expanded='true'><i class='glyph-icon icon-angle-down audit-btn-arr'><\/i>",r=i==n[t].auditId?r+"<span class='audit-title col-md-4'><i class='glyph-icon icon-asterisk'><\/i> Event Date: "+n[t].createdDate+"<\/span>":r+"<span class='audit-title col-md-4'> Event Date: "+n[t].createdDate+"<\/span>",r=r+"<span class='audit-title col-md-4'> Action By: "+n[t].actionPerformedBy+"<\/span>",r=r+"<span class='audit-title col-md-4 '> Action Type: "+n[t].auditActionTypeName+"<\/span><\/div>",r=r+"<div class='panel-collapse collapse panel-mb in' aria-expanded='true' id='collapseOne"+t+"'>",r=r+" <table class='table table-bordered table-striped table-condensed table-wdt'>",r=r+"<tr class='text-warnings'><td class='orange-text'>Field name<\/td><td class='blue-text'>Before change<\/td><td class='green-text'>After change<\/td><\/tr>",n[t].auditInfos===undefined||n[t].auditInfos.length===0)r=r+"<tr>",r=r+"<td> Role Name: "+n[t].auditInfo.fieldName+"<\/td>",r=r+"<td>"+htmlHelper(formatString(n[t].auditInfo.valueBefore))+"<\/td>",r=r+"<td>"+htmlHelper(formatString(n[t].auditInfo.valueAfter))+"<\/td>",r=r+"<\/tr>";else for(u=0;u<n[t].auditInfos.length;u++)r=r+"<tr>",r=r+"<td>"+n[t].auditInfos[u].fieldName+"<\/td>",r=r+"<td>"+htmlHelper(formatNullValue(n[t].auditInfos[u].valueBefore))+"<\/td>",r=r+"<td>"+htmlHelper(formatNullValue(n[t].auditInfos[u].valueAfter))+"<\/td>",r=r+"<\/tr>";r=r+"<\/table><\/div>"}$("#audit").html(r);$("#auditModal").modal("show");$("#auditBtn"+i).next("img").hide();$("#auditBtn"+i).show()})}function formatString(n){var t=n.replace(/","/g,", ");return t.replace(/["\[\]]/g,"")}function formatNullValue(n){return n.replace(/(\([a-zA-Z]+\))/g,"N/A")}function htmlHelper(n){return n.replace(/</g,"&lt;").replace(/>/g,"&gt;")}var nowTemp=new Date,now=new Date(nowTemp.getFullYear(),nowTemp.getMonth(),nowTemp.getDate(),0,0,0,0),startDate=$("#dp1").val(),endDate=$("#dp2").val(),module=$("#ModuleSearch").val(),action=$("#ActionSearch").val(),username=$("#UserSearch").val(),field=$("#FieldSearch").val(),table,rootDir,toolButton;$(function(){$("#auditDataTable").DataTable().clear().destroy();AuditReport();$(".dataTables_filter input").attr("placeholder","Search...");$("#auditDataTable tbody").on("click",".btn-info",function(){var i=$(this).attr("keyfield"),n=$(this).attr("tablename"),r=$(this).attr("auditId"),t;$(this).hide();t=$(this).parents("tr");$("#moduleTitle").html(n);t.find("img").show();GetAuditHistory(i,n,r)});var t=$("#dp1").datepicker({autoclose:!0,todayHighlight:!0}).on("changeDate",function(t){if(startDate=$("#dp1").val(),t.date.valueOf()>n.datepicker("getDate").valueOf()||!n.datepicker("getDate").valueOf()){var i=new Date(t.date);i.setDate(i.getDate()+1);n.datepicker("update",i)}$("#dp2")[0].focus()}),n=$("#dp2").datepicker({beforeShowDay:function(n){return t.datepicker("getDate").valueOf()?n.valueOf()>t.datepicker("getDate").valueOf():n.valueOf()>=(new Date).valueOf()},autoclose:!0}).on("changeDate",function(){endDate=$("#dp2").val();$("#auditDataTable").DataTable().clear().destroy();AuditReport()});$("#ModuleSearch").change(function(){module=$("#ModuleSearch").val();$("#auditDataTable").DataTable().clear().destroy();AuditReport()});$("#ActionSearch").change(function(){action=$("#ActionSearch").val();$("#auditDataTable").DataTable().clear().destroy();AuditReport()});$("#UserSearch").change(function(){username=$("#UserSearch").val();$("#auditDataTable").DataTable().clear().destroy();AuditReport()});$("#FieldSearch").change(function(){field=$("#FieldSearch").val();$("#auditDataTable").DataTable().clear().destroy();AuditReport()})});toolButton=function(n,t,i){var u=i.keyField,f=i.tableName,r=i.id;return'<button id ="auditBtn'+r+'"class="btn btn-info" keyField="'+u+'" tableName="'+f+'" auditId="'+r+'"><i class=\'glyph-icon icon-eye\'><\/i><\/button><img style="width: 30px;display:none" src="'+rootDir+'assets/images/spinner/loader-dark.gif" alt="loading..." display="none">'};